<div style="text-align: center; font-size: 2rem; margin-top: 50px;">
<% colors = ["#BB86FC", "#03DAC6", "#CF6679", "#FFB74D", "#4FC3F7", "#AED581", "#F06292", "#BA68C8"] %>
<% current_color = colors[(@current_task&.sequence.to_i - 1) % colors.length] %>

<div style="text-align: center; margin-top: 30px;" class="fade-in">
  
  <% if @all_done %>
    <h1 style="font-size: 4rem; color: #ff4081;">おめでとう！</h1>
    <p style="font-size: 1.5rem;">全部 できたね！</p>
    
    <div id="quiz-section" style="background: #1e1e1e; padding: 30px; border-radius: 20px; border: 4px solid #bb86fc; margin: 20px;">
      <p style="font-size: 1.5rem; font-weight: bold;">【時間 クイズ】</p>
      
      <% if @minutes_left > 0 %>
        <%# --- 7:20より前のとき：クイズを表示 --- %>
        <p style="font-size: 1.2rem;">家を 出る 7:20 まで</p>
        <p style="font-size: 1.8rem; color: #d32f2f; font-weight: bold;">あと 何分 かな？</p>

        <input type="number" id="user-answer" placeholder="??" 
               style="width: 150px; font-size: 3rem; text-align: center; border-radius: 10px; border: 2px solid #ccc; padding: 10px;">
        <span style="font-size: 2rem;"> 分</span>

        <br><br>

        <button type="button" onclick="checkAnswer()" 
                style="width: 80%; padding: 20px; font-size: 1.5rem; background-color: #2196F3; color: white; border-radius: 15px; border: none; cursor: pointer;">
          答え合わせ！
        </button>

      <% else %>
        <%# --- 7:20を過ぎたとき：警告メッセージを表示 --- %>
        <div style="background-color: #ffcdd2; padding: 20px; border-radius: 15px; border: 3px solid #f44336;">
          <p style="font-size: 2rem; color: #d32f2f; font-weight: bold; margin: 0;">
            7:20を 過ぎています！<br>
            急いで 出発 しましょう！
          </p>
        </div>
      <% end %>

      <div id="result-message" style="margin-top: 20px; font-size: 3rem; font-weight: bold; min-height: 1.2em;"></div>
    </div>

    <script>
      window.checkAnswer = function() {
        const correctAnswer = <%= @minutes_left.to_i %>;
        const inputElement = document.getElementById('user-answer');
        const messageDiv = document.getElementById('result-message');
        
        if (!inputElement || !messageDiv) return;

        const userAnswer = inputElement.value;

        if (userAnswer === "") {
          messageDiv.innerText = "数字を いれてね";
          messageDiv.style.color = "#999";
          return;
        }

        if (parseInt(userAnswer) === correctAnswer) {
          messageDiv.innerText = "✨ 正解！！ ✨";
          messageDiv.style.color = "#ff9800";
        } else {
          messageDiv.innerText = "残念！ もう一度 考えてみよう";
          messageDiv.style.color = "#666";
        }
      };
    </script>

  <% elsif @current_task %>
    <% if @current_task.sequence == 0 %>
      <%# --- おはよう画面（ダークモード最適化） --- %>
      <div style="background-color: #2c2c2c; padding: 40px; border-radius: 30px; border: 5px solid #ffca28; box-shadow: 0 0 20px rgba(255, 202, 40, 0.3);">
         <p style="font-size: 1.5rem; color: #ffca28; margin-bottom: 10px;">あさですよ！</p>
         <h1 style="font-size: 3.5rem; color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.5);"><%= @current_task.name %></h1>
         <%= button_to complete_task_path(@current_task), method: :post, 
             style: "width: 90%; padding: 40px; font-size: 3rem; background: #ffca28; color: #000; border-radius: 50px; border: none; box-shadow: 0 8px #c79100; font-weight: bold; cursor: pointer;" do %>
          ☀️ スタート
         <% end %>
      </div>

    <% else %>
      <%# --- 通常タスク（色が変わる！） --- %>
      <p style="color: #aaa; font-size: 1.5rem;">今 すること（<%= @current_task.sequence %>/8）</p>
      
      <%# タスク名を大きな枠で囲み、色を目立たせる %>
      <div style="margin: 20px; padding: 30px; border-radius: 20px; border: 8px solid <%= current_color %>;">
        <h1 style="font-size: 4.5rem; color: <%= current_color %>; margin: 0;">
          <%= @current_task.name %>
        </h1>
      </div>
      
      <%= button_to 'できた！', complete_task_path(@current_task), method: :post, 
          onclick: "this.style.opacity='0.5'; document.body.style.backgroundColor='#ffffff';", 
          style: "width: 85%; padding: 45px; font-size: 3.5rem; background-color: #03dac6; color: #000; border-radius: 30px; border: none; font-weight: bold; box-shadow: 0 10px #018786;" %>
    <% end %>
  <% end %>

</div>